stages:
  - Acceptance Tests

# Job Linux Fedora - execução dos testes sem docker
WEB Testing in Chrome:
    stage: Acceptance Tests
    image: fedora:31
    tags:
        - docker
    artifacts:
        when: always
        paths:
            - ./results
        expire_in: 1 week
    before_script:
        - cat /etc/*-release
        - dnf upgrade -y >/dev/null && echo OK
        - dnf install -y python37 >/dev/null && echo OK
        - dnf install -y fedora-workstation-repositories >/dev/null && echo OK
        - dnf install -y 'dnf-command(config-manager)' && dnf config-manager --set-enabled google-chrome >/dev/null && echo OK
        - dnf install -y google-chrome-stable >/dev/null && echo OK
        # - dnf install -y chromedriver-stable >/dev/null && echo OK
        # - dnf install -y https://download-ib01.fedoraproject.org/pub/fedora/linux/development/rawhide/Everything/x86_64/os/Packages/c/chromedriver-90.0.4430.93-1.fc35.x86_64.rpm >/dev/null && echo OK
        # - dnf install -y http://dist.control.lth.se/public/Fedora-31/x86_64/google.x86_64/google-chrome-stable-90.0.4430.93-1.x86_64.rpm >/dev/null && echo OK
        - pip3 install webdrivermanager && webdrivermanager chrome
        - chown root /usr/bin/chromedriver >/dev/null && echo OK
        - chmod +x /usr/bin/chromedriver >/dev/null && echo OK
        - chmod 755 /usr/bin/chromedriver >/dev/null && echo OK
        - google-chrome --version
        - chromedriver --version
        - python --version
        - pip3 install robotframework robotframework-seleniumlibrary | grep "Successfully installed"
    script:
        - robot -d ./results -v BROWSER:headlesschrome TestSitePractice.robot

# Job Docker - execução dos testes em container Docker
WEB Testing in Chrome and Docker:
    stage: Acceptance Tests
    image: registry.gitlab.com/myrobotprojects/mydockerimages:latest
    tags:
        - docker
    artifacts:
        when: always
        paths:
            - ./results
        expire_in: 1 week
    script:
        - robot -d ./results -v BROWSER:headlesschrome TestSitePractice.robot
